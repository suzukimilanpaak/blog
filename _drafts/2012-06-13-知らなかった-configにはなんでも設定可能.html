---
layout: post
title: "知らなかった configにはなんでも設定可能"
date: '2012-06-13T03:29:00.000+01:00'
author: Suzuki MilanPaak
tags: 
modified_time: '2012-06-13T03:59:27.009+01:00'
blogger_id: tag:blogger.com,1999:blog-6758697817819098194.post-2140401235192288122
---

知らなかった。いつからか/最初からか？しらないけどconfigにはマジックメソッドがあってなんでも指定可能らしい。今日ソース読んでて気づいた。<br /><br />例えばActionMailerのdefault :fromを developmentでは 'test@example.com' にしてproductionでは 'support@example.com' にするなんていうのは ActionMailerに default :from => Rails.env  == 'development' ? 'test@example.com' : 'support@example.com' と書く以外にこんな方法もありそう<br /><br /># config/environments/development.rb<br /><pre name='code' class='ruby'>Example::Application.configure do<br />  config.action_mailer.defalut_from = 'test@example.com'<br />end<br /></pre><br /># config/environments/production.rb<br /><pre name='code' class='ruby'>Example::Application.configure do<br />  config.action_mailer.defalut_from = 'support@example.com'<br />end<br /></pre><br /><h1>仕組み</h1>irb / pryで手動で試す<br /><br /><pre name='code' class='ruby'>> conf = Rails::Application::Configuration.new<br />=> #<Rails::Application::Configuration:0x106cf2130<br /> @allow_concurrency=false,<br /> @assets=<br />  {:enabled=>false,<br />   :paths=>[],<br />   :<br />   :<br />   長い長い設定<br />> conf.action_mailer<br />=> {:raise_delivery_errors=>false,<br /> :assets_dir=>"/Users/tatsuya-suzuki/work/example/public",<br /> :javascripts_dir=><br />  "/Users/tatsuya-suzuki/work/example/public/javascripts",<br /> :stylesheets_dir=><br />  "/Users/tatsuya-suzuki/work/example/public/stylesheets",<br /> :asset_path=>nil,<br /> :asset_host=>nil,<br /> :relative_url_root=>nil}<br /><br />> conf.action_mailer.default_from = 'test@example.com'<br /><br />> conf.action_mailer<br />=> {:raise_delivery_errors=>false,<br /> :assets_dir=>"/Users/tatsuya-suzuki/work/example/public",<br /> :javascripts_dir=><br />  "/Users/tatsuya-suzuki/work/example/public/javascripts",<br /> :stylesheets_dir=><br />  "/Users/tatsuya-suzuki/work/example/public/stylesheets",<br /> :asset_path=>nil,<br /> :asset_host=>nil,<br /> :relative_url_root=>nil,<br />:default_from=>"test@example.com"}<br /></pre><br />最後の行に:default_from=>"test@example.com"が増えてた！<br /><br />どういうことかというと、Rails::Application::Configuration.newの中でmethod_missingをオーバーライトしてて値の設定と取得をしているんですね。<br /><pre name='code' class='ruby'>module Rails<br />  class Railtie<br />    class Configuration<br />      def initialize<br />        @@options ||= {}<br />      end<br /><br />    private<br />      def method_missing(name, *args, &blk)<br />        if name.to_s =~ /=$/<br />          @@options[$`.to_sym] = args.first<br />        elsif @@options.key?(name)<br />          @@options[name]<br />        else<br />          super<br />        end<br />      end<br />end<br /></pre><br /><a href='http://guides.rubyonrails.org/configuring.html#configuring-action-mailer'>Rails Guides #configuring-action-mailer</a>に書いてあるみたいにこの設定は　’この用途’ですって書いてあると気づかないけど、このconfig.xxx.zzzzていう設定パスをRails内部でも決め打ちで使ってますよーていうことなんですね。<br /><br />.<br />