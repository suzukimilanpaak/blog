---
layout: post
title: Cucumber入門(2) Cucumberの構成
date: '2010-02-26T01:50:00.005Z'
author: Suzuki MilanPaak
tags:
- Ruby/ Ruby on Rails
modified_time: '2010-02-28T20:06:19.207Z'
blogger_id: tag:blogger.com,1999:blog-6758697817819098194.post-8676549707190326345
blogger_orig_url: http://engineerflies.blogspot.com/2010/02/cucumber_26.html
---

<a href=http://engineerflies.blogspot.com/2010/02/cucumber_23.html>前回の続き</a><br /><br /><br />Cucumberは巨大で多くのコンポーネントの集合体です。また構成もいくつか種類があり、試験対象のアプリケーションによって時に構成を変える必要があります。今回はCucumberの構成についてまとめ、選択肢について簡単に解説していきたいと思います。<br /><br />まずはCucumberの依存関係を覗いてみましょう。アウトラインを把握するだけのためで、構成の選択肢とは関係ありません。<br /><pre class=prettyprint><br />$ gem dependency cucumber --version 0.6.2 --remote<br />Gem cucumber-0.6.2<br />  term-ansicolor (>= 1.0.4, runtime)  #標準出力に色をつける<br />  treetop (>= 1.4.2, runtime)         #Ruby用の構文解析器生成系の一つ <br />  polyglot (>= 0.2.9, runtime)        <br />  builder (>= 2.1.2, runtime)<br />  diff-lcs (>= 1.1.2, runtime)<br />  json_pure (>= 1.2.0, runtime)<br />  nokogiri (>= 1.4.1, development)    #HTML解析<br />  prawn (= 0.6.3, development)        #PDF出力<br />  prawn-format (= 0.2.3, development)<br />  rspec (>= 1.3.0, development)<br />  syntax (>= 1.0.0, development)      #Rubyコードのシンタクスハイライチィング<br />  spork (>= 0.7.5, development)       #テストサーバ<br /></pre><br /><br /><h1>代表的な構成</h1><br />単体でCucumberを動かすときは基本的に必要なコンポーネントはcucumberのみです。ただし、rubyのコードを試験したい場合はcucumberのみがセットアップされていれば動作しますが、pythonを試験するときはrubypythonが必要で、Javaを試験するときはjrubyからcucumberを動作させる必要があります。<br /><br />参考 <a href=http://wiki.github.com/aslakhellesoy/cucumber/python>Python</a>　<a href=http://wiki.github.com/aslakhellesoy/cucumber/jruby-and-java>JRuby and Java</a><br /><br />Web applicationを試験したい場合に選択肢が非常に多くなります。ここに代表的な構成を示しておきます。<br /><pre><br /><b>Test Suite for TDD</b><br /> +cucumber<br /> |<br /> <b>Test Suite for Web App</b><br />  +webrat<br />  ||<br />  |<b>Mode</b><br />  |+selenium<br />  |+mechanize<br />  |+rails<br />  |<br />  +capybara<br />  ||<br />  |<b>Driver</b><br />  |+selenium<br />  |+celerity<br />  |+culerity<br />  |<br />  +watir<br />   |<br />   <b>browser</b> <br />    +firewatir<br />    +safariwatir<br />    +chromewatir<br />    +celerity<br /></pre><br /><br />ブラウザテスティングツールについては<a href=http://ruby-toolbox.com/categories/browser_testing.html>ruby-toolbox.com</a>(ライブラリ比較サイト)がよくまとまっているので参考にされると良いと思います。簡単に解説します。<br /><pre><br />Webrat   - Webアプリケーションの受け入れテストを簡単に綺麗に書くためのツール。<br />            それそのものはブラウジングを行いません。seleniumやmechanizeが行います。JavaScript非対応。<br />Capybara - Webratと同等の機能を持つテスティングツール。すべてのブラウザに対応する事を目指している。<br />            すべてのWebアプリケーションを試験できるわけではなく対応しているのはRack applicationのみ。<br />           Xpath, Javascript, AJAX対応<br />Celerity - HtmlUnitのJRuby wrapper。Javaのheadless browser(UIなしブラウザ)です。JavaScript対応<br />Culerity - CucumberとCelerityを統合します。JRuby対応<br />Watir    - 様々なブラウザに対応したテスティングツール。JavaScript非対応<br /></pre><br /><a href=http://wiki.github.com/aslakhellesoy/cucumber/>その他の構成</a><br /><br /><h1>Ruby on Railsを試験するときの構成オプション</h1><br /><pre ><br />ruby script/generate cucumber --webrat | --capybara | --rspec | --testunit | --spork<br /></pre><br />webrat, capybaraに関しては上記したとおりなので割愛します。rspec, testunit optionはstepsの実装をrspec, testunitで書くということではないかと思います。資料が見つからなかったので実装の仕方は分かりません。<br /><br />Sporkオプションはscript/spec_serverに似ています。script/spec_serverはテスト用のDRubyサーバです。Railsの環境をロードしてテストコードがDrb越しにアクセスできるようにします。<br /><br />Spork - テスト用のDRubyサーバ。サーバのコピーをテスト毎にフォークします。カーネルのフォークを利用するのでPOSIX準拠のOSでしか動作しません。SporkはDRbのオーバーヘッドがあるためシナリオの動作は遅くなります。代わりにシナリオを動作させるまでのRails framewokとrubygemsのロード時間を短縮します。つまり、シナリオの数が少ない方がSporkを利用する価値があります。複数になるとある時点でSporkを使っていない場合と速度が反転します。Cucumberのドキュメントによるとそれは"プロジェクトによるが１０ー２０シナリオ前後"であると記されています。<br /><br />＊ Cucumber実行時に--drbオプション(次回以降に扱います)を付けることでfeaturesはSporkサーバ内で実行されます。Rubyインタープリタのプロセスにはロードされません。<br /><br />.