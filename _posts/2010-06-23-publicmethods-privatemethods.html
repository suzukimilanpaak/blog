---
layout: post
title: "インスタンスの状態とpublic_methods, private_methods, singleton_methods, public_instance_methods,
  protected_instance_methods, private_instance_methods"
date: '2010-06-22T19:54:00.008+01:00'
author: Suzuki MilanPaak
tags:
- Ruby/ Ruby on Rails
modified_time: '2010-06-23T16:13:29.011+01:00'
blogger_id: tag:blogger.com,1999:blog-6758697817819098194.post-7088623990635619616
blogger_orig_url: http://engineerflies.blogspot.com/2010/06/publicmethods-privatemethods.html
---

インスタンスの状態とpublic_methods, private_methods, singleton_methods, public_instance_methods, protected_instance_methods, private_instance_methods<br />インスタンスの状態とメソッド検索メソッドの関係についてまとめました。<br /><br />まずはどんなメソッド検索メソッドを調べます。<br /><pre class=ruby name=code><br /># >> Object.methods.select{|m| m=~ /_methods/}  <br /># => ["public_methods", "instance_methods", "singleton_methods", "public_instance_methods", "protected_methods", "protected_instance_methods", "private_methods", "private_instance_methods"]  <br /></pre><br /><br />こんなクラスで試します。<br /><pre class=ruby name=code><br />class MyClass  <br />  def initialize; end  <br />  <br />  def instance_method; end  <br />  def self.singleton_method; end  <br />  <br />protected  <br />  def protected_instance_method; end  <br />  def self.protected_singleton_method; end  <br />  <br />private  <br />  def private_instance_method; end  <br />  def self.private_singleton_method; end  <br />end  <br /></pre><br /><br /><br /><h3>クラスを検索</h3><br />まずはクラスそのものでメソッドの検索をしてみます。methodsという配列との論理積を出しているのは、継承しているメソッドを表示させないためです。=beginで始まるコメントには上の４行の出力結果をそれぞれ示しています。<br /><pre class=ruby name=code><br />methods = ["instance_method", "singleton_method", "protected_instance_method", "protected_singleton_method", "private_instance_method", "private_singleton_method"]  <br />  <br />p methods & MyClass.public_methods.collect{|m| m.to_s}   <br />p methods & MyClass.protected_methods.collect{|m| m.to_s}   <br />p methods & MyClass.private_methods.collect{|m| m.to_s}   <br />p methods & MyClass.singleton_methods.collect{|m| m.to_s}   <br />=begin  <br />["instance_method", "singleton_method", "protected_singleton_method", "private_singleton_method"]  <br />[]  <br />[]  <br />["singleton_method", "protected_singleton_method", "private_singleton_method"]  <br />=end<br />  <br />p methods & MyClass.instance_methods.collect{|m| m.to_s}  <br />p methods & MyClass.public_instance_methods.collect{|m| m.to_s}  <br />p methods & MyClass.protected_instance_methods.collect{|m| m.to_s}  <br />p methods & MyClass.private_instance_methods.collect{|m| m.to_s}  <br />=begin  <br />["instance_method", "protected_instance_method"]  <br />["instance_method"]  <br />["protected_instance_method"]  <br />["private_instance_method"]  <br />=end  <br /></pre>  <br />注意すべきところはpublic_methodsにprotected_singleton_methodとprivate_singleton_methodが含まれるところです。理由はよく分かりません。それから、protected_methodsとprivate_methodsは何も表示しません。<br /><br />instance_methodsはpirvate_instance_methodを表示させません。インスタンスメソッドを検索したい場合はスコープごとに分けて検索するか、すべてのスコープの結果を論理和したものから探すのが良いと思います。<br /><br /><br />インスタンスを検索<br /><pre class=ruby name=code><br />mc = MyClass.new  <br />p methods & mc.public_methods.collect{|m| m.to_s}  <br />p methods & mc.protected_methods.collect{|m| m.to_s}  <br />p methods & mc.private_methods.collect{|m| m.to_s}  <br />p methods & mc.singleton_methods.collect{|m| m.to_s}  <br />=begin  <br />["instance_method"]  <br />["protected_instance_method"]  <br />["private_instance_method"]  <br />[]  <br />=end  <br /></pre><br /><br />インスタンスから検索した場合、当然ながらクラスで定義したシングルトンメソッドは表示されません。代わりにインスタンスにシングルトンメソッドを定義すればsingleton_methods()で発見されます。<br /><br />protected_instance_methodとprivate_instance_methodが発見されます。<br /><br />インスタンスからinstance_xxxx_methodsと名のつくメソッドを実行すると全てundefined methodになります（ので表記してません）。<br /><br /><br /><h3>継承したクラスを検索</h3><br />元のクラスと同じ結果<br /><br /><h3>継承したインスタンスを検索</h3><br />元のクラスのインスタンスと同じ結果<br /><br /><h2>まとめ</h2><br />- シングルトンメソッドは（当たり前だけど）定義したインスタンス（クラスはClassクラスのインスタンス）からしか参照できない。<br />- クラスのprotected_instance_methods(), private_instance_methods()は何も見つけないので何のためにあるか分からない。<br />- instance_methodsはpirvate_instance_methodを含まない<br /><br />ちなみに、メソッド検索メソッドで参照できるのと、callできるかはまた別の話なのでご注意あれ。